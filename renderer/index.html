<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'; img-src 'self' data: https:">
  <title>AzerothCore Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <h1>AzerothCore</h1>
      <span class="subtitle">Server Dashboard</span>
      <span class="version-badge" id="appVersion" title="Current version">v--</span>
    </div>
    <div class="header-right">
      <div class="info-badge" id="playerCount" title="Connected players">
        <span class="info-label">Players</span>
        <span class="info-value" id="playerNum">--</span>
      </div>
      <div class="info-badge" id="uptimeDisplay" title="Server uptime">
        <span class="info-label">Uptime</span>
        <span class="info-value" id="uptimeText">--</span>
      </div>
    </div>
  </header>

  <!-- Update notification banner -->
  <div class="update-banner" id="updateBanner" style="display:none;">
    <div class="update-banner-content">
      <span class="update-icon">↓</span>
      <span class="update-text" id="updateText">Update available</span>
      <div class="update-actions">
        <button class="btn btn-primary btn-sm" id="btnInstallUpdate">Install & Restart</button>
        <button class="btn btn-secondary btn-sm" id="btnDismissUpdate">Dismiss</button>
      </div>
    </div>
    <div class="update-progress" id="updateProgress" style="display:none;">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <span class="progress-text" id="progressText">Downloading...</span>
    </div>
  </div>

  <!-- Tab bar -->
  <nav class="tab-bar">
    <button class="tab active" data-tab="services">Services</button>
    <button class="tab" data-tab="console">Console</button>
    <button class="tab" data-tab="logs">Logs</button>
    <button class="tab" data-tab="config">Config</button>
    <button class="tab" data-tab="realm">Realm Settings</button>
    <button class="tab" data-tab="modules">Modules</button>
    <button class="tab" data-tab="settings">Settings</button>
  </nav>

  <!-- ═══ Tab: Services ═══ -->
  <div class="tab-content active" id="tab-services">
    <div class="toolbar">
      <button class="btn btn-start" id="btnStartAll">Start All</button>
      <button class="btn btn-stop" id="btnStopAll">Stop All</button>
      <label class="toggle-label" title="Auto-restart crashed services">
        <input type="checkbox" id="autoRestartToggle">
        <span class="toggle-slider"></span>
        Auto-Restart
      </label>
    </div>
    <section class="services" id="serviceCards"></section>
  </div>

  <!-- ═══ Tab: Console ═══ -->
  <div class="tab-content" id="tab-console">
    <section class="panel">
      <h2>Server Console</h2>
      <div class="console-output" id="consoleOutput"></div>
      <form class="console-input" id="consoleForm">
        <input type="text" id="consoleCmd" placeholder="Type a GM command (e.g. .server info)" autocomplete="off">
        <button type="submit" class="btn btn-primary">Send</button>
      </form>
    </section>
  </div>

  <!-- ═══ Tab: Logs ═══ -->
  <div class="tab-content" id="tab-logs">
    <section class="panel">
      <h2>Log Viewer</h2>
      <div class="log-controls">
        <select id="logServiceSelect">
          <option value="">-- Select service --</option>
          <option value="ac-database">Database</option>
          <option value="ac-worldserver">Worldserver</option>
          <option value="ac-authserver">Authserver</option>
        </select>
        <button class="btn btn-secondary" id="btnStopLogs">Stop</button>
        <button class="btn btn-secondary" id="btnClearLogs">Clear</button>
      </div>
      <div class="log-output" id="logOutput"></div>
    </section>
  </div>

  <!-- ═══ Tab: Config ═══ -->
  <div class="tab-content" id="tab-config">
    <section class="panel">
      <h2>Server Configuration</h2>
      <p class="panel-hint">Edit <code>docker-compose.override.yml</code> environment variables. Restart the worldserver for changes to take effect.</p>
      <div id="configSections"></div>
      <div class="config-footer">
        <button class="btn btn-primary" id="btnSaveConfig">Save Changes</button>
        <button class="btn btn-secondary" id="btnRefreshConfig">Refresh</button>
        <span id="configStatus" class="realm-status"></span>
      </div>
    </section>
  </div>

  <!-- ═══ Tab: Realm Settings ═══ -->
  <div class="tab-content" id="tab-realm">
    <section class="panel">
      <h2>Realm Settings</h2>
      <p class="panel-hint">Edit realm name and address in the <code>realmlist</code> table. Changes take effect on next server restart.</p>
      <div id="realmList"></div>
      <div id="realmStatus" class="realm-status"></div>
    </section>
  </div>

  <!-- ═══ Tab: Modules ═══ -->
  <div class="tab-content" id="tab-modules">
    <div class="modules-layout">
      <aside class="modules-sidebar" id="moduleList"></aside>
      <section class="modules-body panel" id="moduleReadme">
        <p class="panel-hint">Select a module to view its README.</p>
      </section>
    </div>
  </div>

  <!-- ═══ Tab: Settings ═══ -->
  <div class="tab-content" id="tab-settings">
    <section class="panel">
      <h2>Dashboard Settings</h2>
      <p class="panel-hint">Change connection settings. The dashboard will reconnect using the new values.</p>

      <div class="settings-group">
        <h3 class="settings-group-title">AzerothCore Location</h3>
        <div class="setup-row">
          <div class="setup-field" style="flex:1">
            <label>Project Root</label>
            <div class="browse-row" style="display:flex;gap:6px">
              <input type="text" id="settAcProjectRoot" style="flex:1;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
              <button class="btn btn-secondary" id="settBtnBrowse">Browse</button>
            </div>
          </div>
        </div>
      </div>

      <div class="settings-group">
        <h3 class="settings-group-title">SOAP Connection</h3>
        <div class="setup-row" style="display:flex;gap:10px;margin-bottom:8px">
          <div class="setup-field" style="flex:1">
            <label>Host</label>
            <input type="text" id="settSoapHost" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
          <div class="setup-field" style="flex:1">
            <label>Port</label>
            <input type="text" id="settSoapPort" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
        </div>
        <div class="setup-row" style="display:flex;gap:10px;margin-bottom:8px">
          <div class="setup-field" style="flex:1">
            <label>Username</label>
            <input type="text" id="settSoapUser" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
          <div class="setup-field" style="flex:1">
            <label>Password</label>
            <input type="text" id="settSoapPass" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
        </div>
      </div>

      <div class="settings-group">
        <h3 class="settings-group-title">MySQL Connection</h3>
        <div class="setup-row" style="display:flex;gap:10px;margin-bottom:8px">
          <div class="setup-field" style="flex:1">
            <label>Host</label>
            <input type="text" id="settDbHost" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
          <div class="setup-field" style="flex:1">
            <label>Port</label>
            <input type="text" id="settDbPort" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
        </div>
        <div class="setup-row" style="display:flex;gap:10px;margin-bottom:8px">
          <div class="setup-field" style="flex:1">
            <label>Username</label>
            <input type="text" id="settDbUser" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
          <div class="setup-field" style="flex:1">
            <label>Password</label>
            <input type="text" id="settDbPass" style="width:100%;background:var(--bg-input);border:1px solid var(--gold-dim);border-radius:var(--radius);padding:8px 10px;color:var(--text);font-size:0.85rem;outline:none">
          </div>
        </div>
      </div>

      <div class="config-footer">
        <button class="btn btn-primary" id="btnSaveSettings">Save Settings</button>
        <span id="settingsStatus" class="realm-status"></span>
      </div>
    </section>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
